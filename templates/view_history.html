{% extends "base.html" %}
{% block content %}
<div class="hero">
    <h1>Patient Medical History</h1>
    <p>A complete, tamper-proof record of all on-chain medical events.</p>
</div>

{% if session.role == 'Doctor' or session.role == 'Administrator' %}
    <div class="card" style="max-width: 600px; margin: 0 auto;">
        <form method="POST">
            <div class="mb-3">
                <label for="patient_id" class="form-label">Patient ID to View</label>
                <input type="text" class="form-control" id="patient_id" name="patient_id" placeholder="Enter the Patient ID you wish to look up" required>
            </div>
            <button type="submit" class="btn">
                <i class="fas fa-search"></i>
                Search History
            </button>
        </form>
    </div>
{% endif %}

{% if history is not none %}
<div class="dashboard" style="margin-top: 2rem;">
    {% if history %}
        {% for record in history %}
        <div class="card">
            <div class="card-icon">
                <i class="fas fa-notes-medical"></i>
            </div>
            <h3>{{ record.record_id }} ({{ record.record_type }})</h3>
            <p><strong>Operation:</strong> {{ record.operation }} | <strong>Doctor:</strong> {{ record.doctor_id }}</p>
            <p><strong>Details:</strong> {{ record.prescription }}</p>
            <p><small><strong>Timestamp:</strong> {{ record.timestamp }}</small></p>
        </div>
        {% endfor %}
    {% else %}
        <div class="card" style="text-align: center; grid-column: 1 / -1;">
            {% if session.role == 'Patient' %}
                <h3 style="color:white;">Your History is Empty</h3>
                <p style="color: rgba(255,255,255,0.8);">There are currently no medical records for you on the blockchain.</p>
            {% else %}
                <h3 style="color:white;">No Records Found</h3>
                <p style="color: rgba(255,255,255,0.8);">No medical records were found for the specified patient ID.</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endif %}

<style>
    .form-label { color: white; font-weight: 500; }
    .form-control {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: white;
        padding: 0.75rem 1rem;
        width: 100%;
    }
</style>
{% endblock %}